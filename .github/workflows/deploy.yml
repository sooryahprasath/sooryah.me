name: CI/CD Pipeline

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    name: Production Deployment
    runs-on: self-hosted
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Deploy Updates
        run: |
          # 1. Build the image locally
          # We use build because the code is right here on the server
          docker compose build

          # 2. Restart containers to load new Python logic & HTML
          # This automatically picks up your local .env file for secrets
          docker compose up -d --force-recreate

      - name: Verification
        run: |
          sleep 5
          # 3. Verify against the new FastAPI container (portfolio-web)
          # The path inside the container is now /app/static/
          docker exec portfolio-web grep "Senior Network Automation Engineer" /app/static/index.html
          echo "âœ… Verification Passed: FastAPI is serving the correct content."